"use strict";angular.module("meteoApp",["ngResource","ngRoute","owmServices","ngLadda"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/details",{templateUrl:"views/details.html",controller:"DetailsCtrl"}).otherwise({redirectTo:"/"})}]).run(["$http",function(){}]);var showNotifCallback=function(a,b){new b("Il va geler !",{body:"Il est prévu "+a+"° cette nuit."})};angular.module("meteoApp").controller("MainCtrl",["$scope","$rootScope","DailyForecast","$window",function(a,b,c,d){b.jourLoading=1,a.dailyForecast=c.query({},function(a){var c=a[0].temp.night;if(parseFloat(c)<5)if("Notification"in d){var e=d.Notification.permission;"default"===e?d.Notification.requestPermission(function(a){"granted"===a&&showNotifCallback(c,d.Notification)}):"granted"===e&&showNotifCallback(c,d.Notification)}else console.log("No notification API support.");b.jourLoading=0},function(c){a.errorMsg=c,b.jourLoading=0})}]).controller("DetailsCtrl",["$scope","$rootScope","Forecast",function(a,b,c){b.heureLoading=1,a.forecast=c.query({},function(){b.heureLoading=0},function(c){a.errorMsg=c,b.heureLoading=0})}]).controller("MenuCtrl",["$scope",function(a){a.$on("$routeChangeSuccess",function(b,c){var d=c.$$route.controller;"MainCtrl"===d?a.activeTab="jour":"DetailsCtrl"===d&&(a.activeTab="heure")})}]);var endpoint="http://api.openweathermap.org/data/2.5/forecast",doTransformResponse=function(a){var b=JSON.parse(a).list;return angular.forEach(b,function(a){a.dt=1e3*parseInt(a.dt,10)}),b};angular.module("owmServices",[]).factory("DailyForecast",["$resource",function(a){return a(endpoint+"/daily",{mode:"json",units:"metric",q:"Poissy",cnt:"14"},{query:{method:"GET",isArray:!0,transformResponse:function(a){return doTransformResponse(a)},cache:!0}})}]).factory("Forecast",["$resource",function(a){return a(endpoint,{mode:"json",units:"metric",q:"Poissy"},{query:{method:"GET",isArray:!0,transformResponse:function(a){return doTransformResponse(a)},cache:!0}})}]);